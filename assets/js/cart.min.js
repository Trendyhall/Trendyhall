document.addEventListener("DOMContentLoaded",()=>{new class{constructor(){}NewOrder(e,t,a,l,r,n){fetch("/orders/new-order",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({orderbody:e,comment:t,data:a,ordertime:l})}).then(e=>{if(e.ok)return e.text();n(e.text())}).then(e=>{0!=e&&r(e)})}};function e(e,t){let a=JSON.parse(localStorage.getItem("cart"));null==a&&(a={}),null==a[e]?(localStorage.setItem("user-cart-count",Number(localStorage.getItem("user-cart-count"))+1),document.querySelector(".icon-cart").setAttribute("data-qty",localStorage.getItem("user-cart-count")),a[e]=t):a[e]=t,localStorage.setItem("cart",JSON.stringify(a)),d(),o()}function t(e){let t=JSON.parse(localStorage.getItem("cart"));null==t&&(t={}),null!=t[e]&&(localStorage.setItem("user-cart-count",Number(localStorage.getItem("user-cart-count"))-1),document.querySelector(".icon-cart").setAttribute("data-qty",localStorage.getItem("user-cart-count")),delete t[e]),localStorage.setItem("cart",JSON.stringify(t)),d(),o()}function a(e){let t=JSON.parse(localStorage.getItem("cart"));return null==t&&(t={}),null!=t[e]?t[e]:0}function l(e){let t=JSON.parse(localStorage.getItem("like"));null==t&&(t={}),t[e]="",localStorage.setItem("like",JSON.stringify(t))}function r(e){let t=JSON.parse(localStorage.getItem("like"));null==t&&(t={}),delete t[e],localStorage.setItem("like",JSON.stringify(t))}function n(e){let t=JSON.parse(localStorage.getItem("like"));return null==t&&(t={}),null!=t[e]}function o(){document.querySelector(".icon-cart svg").classList.add("add-to-cart-animation"),setTimeout(()=>{document.querySelector(".icon-cart svg").classList.remove("add-to-cart-animation")},2100)}function d(){new bootstrap.Toast(document.getElementById("cartChangeToast")).show()}function i(){let e=document.querySelectorAll("[data-likeid]:not(#addToLike)");for(let t of e)n(t.getAttribute("data-likeid"))&&t.classList.add("active"),t.onclick=(()=>{n(t.getAttribute("data-likeid"))?(t.classList.remove("active"),r(t.getAttribute("data-likeid"))):(t.classList.add("active"),l(t.getAttribute("data-likeid")))})}if(document.getElementById("sizeOffcanvasBtn")){let o=document.getElementById("sizeList"),d=document.getElementById("cartSelect");function c(){if(function(e){let t=JSON.parse(localStorage.getItem("cart"));return null==t&&(t={}),null!=t[e]}(o.children[o.getAttribute("data-lt-target")].getAttribute("data-lt-id"))){for(var e=2;e<d.children.length;e++)d.children[e].remove();for(e=2;e<=Number(o.children[o.getAttribute("data-lt-target")].children[0].textContent);e++)d.insertAdjacentHTML("beforeend",'<option value="'+e+'">'+e+"</option>");d.value=a(o.children[o.getAttribute("data-lt-target")].getAttribute("data-lt-id")),d.classList.remove("d-none"),document.getElementById("addToCart").classList.add("d-none")}else document.getElementById("cartSelect").classList.add("d-none"),document.getElementById("addToCart").classList.remove("d-none")}d.onchange=(()=>{let a=o.children[o.getAttribute("data-lt-target")].getAttribute("data-lt-id");0==d.value&&(t(a),c()),d.value>0&&e(a,d.value)});for(var s=0;s<o.children.length;s++)o.children[s].setAttribute("data-lt-index",s),o.children[s].onclick=(t=>{o.getAttribute("data-lt-target")>-1?o.children[o.getAttribute("data-lt-target")].classList.remove("active"):(document.getElementById("addToCart").removeAttribute("disabled"),document.getElementById("addToCartBadge").remove()),o.children[t.currentTarget.getAttribute("data-lt-index")].classList.add("active"),o.setAttribute("data-lt-target",t.currentTarget.getAttribute("data-lt-index")),document.getElementById("sizeOffcanvasBtn").innerHTML=o.children[t.currentTarget.getAttribute("data-lt-index")].firstChild.textContent+"<span>&#10095;</span>",c(),document.getElementById("addToCart").onclick=(()=>{e(o.children[o.getAttribute("data-lt-target")].getAttribute("data-lt-id"),1),c()})});let i=document.getElementById("addToLike");n(i.getAttribute("data-likeid"))&&(i.classList.add("active"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 4.41c1.387-1.425 4.854 1.07 0 4.277C3.146 5.48 6.613 2.986 8 4.412z"/><path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/></svg>'),i.onclick=(()=>{n(i.getAttribute("data-likeid"))?(i.classList.remove("active"),r(i.getAttribute("data-likeid")),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/></svg>'):(i.classList.add("active"),l(i.getAttribute("data-likeid")),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 4.41c1.387-1.425 4.854 1.07 0 4.277C3.146 5.48 6.613 2.986 8 4.412z"/><path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/></svg>')})}if(document.getElementById("likeCardsContainer")){let e=JSON.parse(localStorage.getItem("like"));null==e&&(e={}),fetch("/like-cards",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then(e=>e.text()).then(e=>{document.getElementById("likeCardsContainer").innerHTML=e,i()})}if(document.getElementById("cartCardsContainer")){let l=JSON.parse(localStorage.getItem("cart"));null==l&&(l={});let r=!1;for(let e in l){r=!0;break}r?fetch("/cart-cards",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(l)}).then(e=>e.text()).then(r=>{function n(){null==(l=JSON.parse(localStorage.getItem("cart")))&&(l={});let e=document.getElementById("cartOverview");e.innerHTML="";let t=!1;for(let e in l){t=!0;break}if(t){for(obj of(document.getElementById("BuyBtn").parentNode.classList.remove("d-none"),document.getElementById("cartCardsContainer").children)){let t='<div class="d-flex"><div class="col-2"><img src="'+obj.querySelector("img").src+'" alt="" class="w-100"></div><div class="col-10 pe-0 ps-2 align-self-center">'+obj.querySelector(".card-name").innerHTML+'</div></div><div class="col-12 p-0">'+obj.querySelector(".card-price").innerHTML+" x <span>"+obj.querySelector("select").value+"</span> = <span>"+(Number(obj.querySelector(".card-price").innerHTML.replace(/₽| /g,""))*Number(obj.querySelector("select").value)+"").split(/(?=(?:\d{3})+$)/).join(" ")+'</span> ₽</div><hr class="mt-1 mb-1">';e.insertAdjacentHTML("beforeend",t)}let t=0;document.querySelectorAll("#cartOverview span:last-child").forEach(e=>{t+=Number(e.innerHTML.replace(/₽| /g,""))}),t=(t+"").split(/(?=(?:\d{3})+$)/).join(" "),e.parentNode.querySelector("h4").innerHTML="Сумма: "+t+" ₽",document.forms.order.orderBody.value=localStorage.getItem("cart")}else document.getElementById("BuyBtn").parentNode.classList.add("d-none"),document.getElementById("cartCardsContainer").innerHTML="<h2>Корзина пуста</h2>",document.getElementById("cartOverview").innerHTML=""}document.getElementById("cartCardsContainer").innerHTML=r,document.querySelectorAll("[data-delete-id]").forEach(e=>{t(e.getAttribute("data-delete-id")),e.remove()});for(let e of document.querySelectorAll("[data-closeid]"))e.onclick=(()=>{t(e.getAttribute("data-closeid")),e.parentNode.parentNode.parentNode.remove(),n()});document.querySelectorAll("select").forEach(t=>{t.value=a(t.parentNode.parentNode.querySelector("[data-closeid]").getAttribute("data-closeid")),t.onchange=(t=>{e(t.currentTarget.parentNode.parentNode.querySelector("[data-closeid]").getAttribute("data-closeid"),t.currentTarget.value),n()})}),i(),n()}):(document.getElementById("BuyBtn").parentNode.classList.add("d-none"),document.getElementById("cartCardsContainer").innerHTML="<h2>Корзина пуста</h2>",document.getElementById("cartOverview").innerHTML="");let n=document.forms.order;document.querySelectorAll("input[type=radio]").forEach(e=>{e.onclick=(()=>{let e=document.getElementById("DeliveryTypeCollapse1");"1"==n.DeliveryType.value?e.classList.remove("d-none"):e.classList.add("d-none"),e=document.getElementById("DeliveryTypeCollapse2"),"2"==n.DeliveryType.value?e.classList.remove("d-none"):e.classList.add("d-none")})}),n.name.oninput=(()=>{let e=n.name;if(e.parentNode.classList.add("was-validated"),/[^a-zA-Zа-яА-Я ]/.test(e.value)){let t=e.selectionStart-1;e.value=e.value.replace(/[^a-zA-Zа-яА-Я ]/g,""),e.setSelectionRange(t,t)}});let o=n.phone.value;n.phone.oninput=(()=>{let e=n.phone;if(/[^0-9+]/.test(e.value)){let t=e.selectionStart-1;e.value=e.value.replace(/[^0-9+]/g,""),e.setSelectionRange(t,t)}"+"==e.value[0]?e.value.length<=12&&(o=e.value):e.value.length<=11&&(o=e.value),e.value=o;/\+7\d{10}|8\d{10}/.test(e.value)&("8"==e.value[0]&11==e.value.length|"+"==e.value[0]&12==e.value.length)?(e.classList.add("is-valid"),e.classList.remove("is-invalid")):(e.classList.add("is-invalid"),e.classList.remove("is-valid"))}),n.addEventListener("submit",function(e){if(e.preventDefault(),e.stopPropagation(),/[a-zA-Zа-яА-Я ]/.test(n.name.value)){let e=/\+7\d{10}|8\d{10}/,r=n.phone;if(e.test(r.value)&("8"==r.value[0]&11==r.value.length|"+"==r.value[0]&12==r.value.length)){let e=new Uint16Array(1);for(;e[0]<1e3;)window.crypto.getRandomValues(e);n.ordertime.value=(t=new Date,a=("0"+(t.getMonth()+1)).slice(-2),l=("0"+t.getDate()).slice(-2),t.getFullYear()+"-"+a+"-"+l+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)),n.passcode.value=e[0],n.submit()}}var t,a,l})}i()});